# Trigger QuickSight Lambda

A lambda function that takes the data extracted from the [triggerETL-Lambda](https://github.com/Dazza65/triggerETL-Lambda) project and ingests into AWS QuickSight for visualisation.

This is the final part of an overall solution to provide DevOps Key Performance Indicators on a AWS QuickSight dashboard.
1. [Retrieve the data](https://github.com/Dazza65/getJIRAData)
1. [Transform the data and perform the KPI calculation](https://github.com/Dazza65/triggerETL-Lambda)
1. Ingest the transformed data to QuickSight (This repository)

## Build and deploy

1. Clone the repository
1. Install the following dependencies
    1. [jq](https://stedolan.github.io/jq/)
    1. AWS CLI (v2.0.62)
1. <pre><code>sh ./package.sh</code></pre>(Creates the triggerETL.zip file in the build folder)
1. <pre><code>sh ./upload.sh</code></pre> (Copies the zip file to the specified S3 bucket to store the lambda function)
1. <pre><code>sh ./build-qs-json.sh</code></pre>(Creates the QuickSight JSON file in the build directory)
1. <pre><code>sh ./upload-qs.sh</code></pre>(Uploads the QuickSight JSON file to the S3 ETL output bucket)
1. <pre><code>sh ./create-stack.sh</code></pre> (Creates the CloudFormation stack for all of the required resources)

## The following AWS resources are created

1. Lambda function (DevOpsKpiTriggerQS) and its associated role
1. A QuickSight Data Source using the data file in S3 ETL output bucket (as generated by the 2nd step in the process)
1. A QuickSight Data Set (DevOpsKpiJIRADS)

At the time of writing, the CloudFormation support for creating the Analysis from the above resources is not adaquate and so this will need to be done by hand using the QuickSight console.  Select the data set from the UI and click the <span style="color: cyan">Create Analysis</span> button.

## Architecture Diagram

![Architecture Diagram](images/DevOpsKPIs-3.png)